

## 메모리 구조
---


![[Pasted image 20250316215947.png]]

프로그램이 실행 되기 위해선 먼저 프로그램이 메모리에 로드 되어야한다.

프로그램을 실행 하게 되면 OS는 메모리(RAM)에 공간을 할당해준다.

<span style="font-size:1.5em;"><font color="#ffb6c1">메모리 공간은</font></span> <font color="#77dd77">코드(Code)</font>, <font color="#b2f7ef">데이터(Data)</font>, <font color="#8db3e2">스택(Stack)</font>, <font color="#e36c09">힙(Heap)</font> 영역으로 나눈다

### <font color="#77dd77">코드 (Code)</font>
---


- 작성한 소스코드가 저장되는 영역으로 텍스트 영역이라고도 부른다.
- 기계어 형태 `이진수(0,1)` 로 저장한다.
- 이 영역은 **읽기 전용** 이며 , 실행 파일이 로드 될때 메모리에 적재된다.

#### <font color="#548dd4">Feature</font>
- 변경 불가능 ( 읽기 전용 )
- 함수,메서드,루프 등의 실행 코드를 포함한다.
- 메모리 크기가 고정적이며 프로그램 종료 시까지 유지한다.


### <font color="#b2f7ef">데이터 (Data)</font>
---


- **전역 변수**와 **정적 변수** 가 할당되는 영역이다. 

- 메인 함수 전에 선언되어 프로그램의 시작과 동시에 할당되고 프로그램이 종료 되야   메모리가 소멸이 된다.

 ( 진짜 항상 그렇게 static , 전역변수 뭔지도 모르면서 써왔는데 
 이제서야 본질을 알고 쓰게 되는걸까 하지만 이 문서에서 다루기에는 갑자기 방대해져서 흐름을 방해하지않기위해 옮겼다.)

#### <font color="#00b0f0">Feature</font>

- 초기화된 데이터와 초기화 되지않는 데이터로 나뉜다.
   - **초기화된 데이터** : 값이 명시적으로 설정된 전역/정적 변수.
   - **초기화되지 않은 데이터** : 값이 설정되지 않는 변수

```
초기화된 데이터는 
int foodCount = 10; ( 10으로 초기설정된 데이터)

초기화 되지않는 데이터는 
static int staticData; ( 자동으로 기본값으로 int 는 0, float 는 0.0 , 포인터는 null)
과 같이 설정됨 . 
```

### <font color="#e36c09">Heap 영역</font>
---


- 참조 타입 저장 : 배열 , 클래스 객체 등 참조 타입 데이터는 힙에 저장된다.
- **Garbage Collection**: 사용하지 않는 데이터를 자동으로 정리 하여 메모리를 관리한다.

여기에서 Garbage Collection (GC) 에 대해서 조금 더 얘기해보겠다.

#### <font color="#b2f7ef">Garbage Collection (GC)</font>

GC가 실행 되는시점은 총 4가지
- 힙 메모리가 부족할 때
- CPU가 한가할때
- 객체가 참조 되지 않을 때 (선언만 되고 사용되지않는 객체)
- 수동 실행 

작동 방식은 Mark-and-Relocating 방식으로 

 1. Marking Phase
	 - GC는 모든 참조 가능한 객체를 탐색하고 살아있는 객체를 'Mark' 표시한다.
 2. Relocating
	 - 참조되지 않는 객체를 제거하고 해당 메모리를 회수한다. (Sweep)
3. Compact
	 - Mark 해서 Sweep 당하지 않은 객체들을 힙 메모리 한쪽으로 이동시켜 
		단편화를 줄이고 연속적인 메모리 공간을 확보한다.
		
		
![[Pasted image 20250317001000.png]]

더 자세한 설명은 추후 설명하겠다.

### <font color="#8db3e2">스택 영역 (Stack)</font>
----


- 스택은 함수 호출 시 생성되는 지역 변수와 함수 호출 정보를 저장한다.
- 함수가 끝나면 해당 스택 프레임은 **자동으로 제거된다.**

그렇다. 보면 뭔소리인지 싶겠다. 어쩌라고 싶겠다. 조금 더 비유를 해보자

#### <font color="#00b0f0">Feature</font>


![[Pasted image 20250316230107.png]]

상기 내용은 스택 공간을 코드블럭으로 시각적으로 표현해보았다.

### <font color="#b2f7ef">Heap vs Stack</font>
---


| 특성        | Stack                     | Heap                   |
| --------- | ------------------------- | ---------------------- |
| 저장데이터     | 값 타입 (Value Type)         | 참조 타입 (Reference Type) |
| 메모리 관리 방식 | 자동 (함수 종료 시 제거)           | 가비지 컬렉션으로 자동 관리        |
| 속도        | 빠름                        | 느림                     |
| 메모리 크기    | 작음                        | 큼                      |
| 데이터       | LIFO (Last in, First Out) | 자유로운 할당 및 해제 가능        |

요약
1. 스택 (Stack):
	- 함수 호출 시 생성되는 지역 변수와 값 타입 데이터를 저장.
	- 빠르고 자동으로 메모리를 관리.
2. 힙 (Heap):
	- 참조 타입 데이터를 동적으로 할당하여 저장.
	- 가비지 컬렉션을 통해 메모리를 관리.
3. 두 영역은 프로그램 실행 중 서로 협력하여 효율적으로 데이터를 관리하며,
	 데이터의 특성에 따라 적절히 활용 해야 한다.

#### <font color="#b2f7ef">다시 한번 stackoverflow 에 대해서는</font>

```
void infinity()
{
	infinity(); // 무한 재귀 호출 - > stack overflow
}
```

이런식으로 무한 루프나 너무 많은 함수 호출을 하게 되면 느려지므로 주의하자!

